name: ğŸ›¡ï¸ Template Validation

on:
  push:
    branches: [ main, develop ]
    paths:
      - '**/*.template'
      - 'validate-templates.js'
      - '.github/workflows/validate-templates.yml'
  pull_request:
    branches: [ main, develop ]
    paths:
      - '**/*.template'
      - 'validate-templates.js'
      - '.github/workflows/validate-templates.yml'

jobs:
  validate:
    name: Validate Template Variables
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ“¦ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        registry-url: 'https://npm.pkg.github.com'
        scope: '@mvp-kit'

    - name: ğŸ”‘ Configure GitHub packages
      run: |
        echo "@mvp-kit:registry=https://npm.pkg.github.com" >> ~/.npmrc
        echo "//npm.pkg.github.com/:_authToken=${{ secrets.GITHUB_TOKEN }}" >> ~/.npmrc

    - name: ğŸ” Validate templates
      run: npx @mvp-kit/template-validator core

    - name: âœ… Validation passed
      if: success()
      run: |
        echo "ğŸ‰ All templates use only approved variables!"
        echo "âœ… Template validation successful"

    - name: âŒ Validation failed
      if: failure()
      run: |
        echo "ğŸ’¥ Template validation failed!"
        echo "ğŸ”§ Fix unauthorized variables before merging"
        echo "ğŸ“‹ Allowed: {{projectName}}, {{projectDescription}}, {{domainName}}, {{packageManager}}, {{packageManagerVersion}}"
        exit 1